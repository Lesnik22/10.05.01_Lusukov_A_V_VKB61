# Тестирование системы аудита безопасности

## Описание

Скрипт `test_security_audit.py` предназначен для тестирования всех функций улучшенной системы аудита безопасности.

## Возможности

1. **Создание тестовых событий безопасности**
   - Создает события разных типов (suspicious_login, virus_detected, blocked_download и т.д.)
   - Разные уровни severity (low, medium, high, critical)
   - Разные статусы (new, acknowledged, resolved)
   - События за последние 7 дней
   - Группа событий с одного IP для тестирования корреляции

2. **Создание тестовых алертов**
   - Алерт на критические события вирусов
   - Алерт на множественные подозрительные входы
   - Алерт на высокий уровень событий

3. **Создание тестовых изменений конфигурации**
   - Изменения ролей
   - Изменения отделов
   - Изменения настроек

4. **Тестирование корреляции событий**
   - Автоматическое создание инцидентов из связанных событий

5. **Просмотр статистики**
   - Статистика по событиям безопасности
   - Статистика по инцидентам
   - Статистика по алертам
   - Статистика по изменениям конфигурации
   - Топ IP адресов по событиям

6. **Очистка тестовых данных**
   - Удаление всех созданных тестовых данных

## Использование

### Запуск скрипта

```bash
python test_security_audit.py
```

### Меню скрипта

После запуска вы увидите меню:

```
1. Создать тестовые события безопасности
2. Создать тестовые алерты
3. Создать тестовые изменения конфигурации
4. Запустить корреляцию событий
5. Показать статистику
6. Выполнить все тесты
7. Очистить тестовые данные
0. Выход
```

### Рекомендуемый порядок тестирования

1. **Сначала создайте тестовые данные:**
   - Выберите пункт 6 (Выполнить все тесты) - это создаст все необходимые тестовые данные

2. **Проверьте результаты в веб-интерфейсе:**
   - Откройте админ-панель: `http://localhost:5000/admin`
   - Перейдите в раздел "Управление безопасностью"
   - Проверьте страницы:
     - События безопасности (`/admin/security/events`)
     - Инциденты (`/admin/security/incidents`)
     - Алерты (`/admin/security/alerts`)
     - История изменений (`/admin/config/changes`)

3. **Проверьте фильтрацию:**
   - На странице событий безопасности попробуйте разные фильтры
   - Проверьте экспорт в CSV и JSON

4. **Проверьте корреляцию:**
   - Запустите пункт 4 (Запустить корреляцию событий)
   - Проверьте созданные инциденты на странице `/admin/security/incidents`

5. **Проверьте статистику:**
   - Запустите пункт 5 (Показать статистику)
   - Сравните с данными в веб-интерфейсе

## Что проверяется

### ✅ События безопасности
- Создание событий с разными параметрами
- Фильтрация по типу, severity, статусу, дате, IP, пользователю
- Поиск по деталям
- Экспорт в CSV/JSON
- Изменение статуса (acknowledge/resolve)

### ✅ Алерты
- Создание алертов с разными условиями
- Автоматическое срабатывание алертов
- Уведомления администраторов

### ✅ Корреляция событий
- Группировка событий по IP
- Создание инцидентов из связанных событий
- Определение severity инцидента

### ✅ Логирование конфигурации
- Логирование изменений ролей
- Логирование изменений отделов
- Логирование изменений настроек
- Сохранение старых и новых значений

## Очистка тестовых данных

После тестирования можно удалить все тестовые данные:

1. Запустите скрипт
2. Выберите пункт 7 (Очистить тестовые данные)
3. Подтвердите удаление (введите `yes`)

## Примечания

- Скрипт не удаляет реальные данные пользователей
- Тестовые данные помечаются словами "Тестовое" в деталях
- При создании событий используются тестовые IP адреса (192.168.1.x, 10.0.0.x)
- Для корректной работы требуется хотя бы один пользователь в системе

## Устранение проблем

### Ошибка "Нет пользователей в системе"
- Убедитесь, что в системе есть хотя бы один пользователь
- Запустите приложение и создайте пользователя через веб-интерфейс

### Ошибка подключения к БД
- Убедитесь, что база данных создана
- Проверьте настройки подключения в `config.py`

### Ошибка при создании событий
- Проверьте, что все миграции БД выполнены
- Убедитесь, что таблицы созданы (`db.create_all()`)


